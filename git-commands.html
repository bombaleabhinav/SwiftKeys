<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monkeytype Clone</title>
  <style>
    body {
      margin: 0;
      font-family: 'Courier New', Courier, monospace;
      background-color: #0f0f0f;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    #test-box {
      max-width: 800px;
      text-align: left;
      font-size: 24px;
      line-height: 1.6;
      word-wrap: break-word;
      margin-bottom: 20px;
    }

    .word {
      margin-right: 10px;
    }

    .char {
      display: inline-block;
    }

    .char.correct {
      color: #4caf50;
    }

    .char.incorrect {
      color: #f44336;
    }

    .char.active {
      text-decoration: underline;
    }

    #input {
      opacity: 0;
      position: absolute;
    }

    #live-stats {
      margin-bottom: 10px;
      font-size: 18px;
      color: #ccc;
    }
  </style>
</head>
<body>

  <div id="test-box"></div>
  <input type="text" id="input" autofocus />

  <div id="live-stats">
    <p>
      <strong>WPM:</strong> <span id="live-wpm">0</span>
      &nbsp;
      <strong>Accuracy:</strong> <span id="live-accuracy">0</span>%
    </p>
  </div>

  <script>
    const wordList = "the quick brown fox jumps over the lazy dog speed coding test monkeytype clone javascript typing challenge practice fast keyboard performance error feedback".split(" ");
    const testBox = document.getElementById("test-box");
    const input = document.getElementById("input");
    const liveWpmDisplay = document.getElementById("live-wpm");
    const liveAccDisplay = document.getElementById("live-accuracy");

    let words = [];
    let typedChars = [];
    let currentWordIndex = 0;
    let currentCharIndex = 0;
    let startTime = null;
    let testEnded = false;

    function generateWords() {
      const manualString = "this is a manual typing test string to practice typing accuracy and speed";
      words = manualString.trim().split(/\s+/);
    }

    function renderWords() {
      testBox.innerHTML = '';
      typedChars = [];
      words.forEach((word, wi) => {
        const wordSpan = document.createElement('span');
        wordSpan.className = 'word';
        wordSpan.setAttribute('data-word-index', wi);

        [...word].forEach((char) => {
          const charSpan = document.createElement('span');
          charSpan.className = 'char';
          charSpan.innerText = char;
          wordSpan.appendChild(charSpan);
        });

        testBox.appendChild(wordSpan);
        typedChars.push([]);
      });
    }

    function highlightActiveChar() {
      document.querySelectorAll('.char.active').forEach(c => c.classList.remove('active'));

      const wordSpan = document.querySelector(`.word[data-word-index="${currentWordIndex}"]`);
      if (!wordSpan) return;

      const charSpan = wordSpan.children[currentCharIndex] || wordSpan.lastChild;
      if (charSpan) charSpan.classList.add('active');
    }

    function calculateStats() {
      let totalTyped = 0;
      let correct = 0;

      for (let wi = 0; wi < typedChars.length; wi++) {
        const typedWord = typedChars[wi];
        const actualWord = words[wi];
        for (let ci = 0; ci < typedWord.length; ci++) {
          totalTyped++;
          if (actualWord[ci] === typedWord[ci]) {
            correct++;
          }
        }
      }

      const timeElapsed = (Date.now() - startTime) / 1000 / 60; // minutes
      const wpm = timeElapsed > 0 ? Math.round((correct / 5) / timeElapsed) : 0;
      const accuracy = totalTyped > 0 ? Math.round((correct / totalTyped) * 100) : 100;

      return { wpm, accuracy };
    }

    function updateLiveStats() {
      const { wpm, accuracy } = calculateStats();
      liveWpmDisplay.textContent = wpm;
      liveAccDisplay.textContent = accuracy;
    }

    function endTest() {
      testEnded = true;
      input.disabled = true;
      input.blur();
    }

    input.addEventListener('keydown', (e) => {
      if (testEnded) return;
      if (!startTime) startTime = Date.now();

      const currentWord = words[currentWordIndex];
      const wordSpan = document.querySelector(`.word[data-word-index="${currentWordIndex}"]`);
      const chars = wordSpan.querySelectorAll('.char');

      if (e.key === ' ') {
        e.preventDefault();

        currentWordIndex++;
        currentCharIndex = 0;

        if (currentWordIndex >= words.length) {
          endTest();
        } else {
          highlightActiveChar();
        }
        updateLiveStats();
        return;
      }

      if (e.key === 'Backspace') {
        e.preventDefault();

        if (currentCharIndex > 0) {
          currentCharIndex--;
          typedChars[currentWordIndex].pop();
          chars[currentCharIndex].classList.remove('correct', 'incorrect');
        } else if (currentWordIndex > 0) {
          currentWordIndex--;
          currentCharIndex = typedChars[currentWordIndex].length;
          typedChars[currentWordIndex].pop();
          const prevChars = document.querySelectorAll(`.word[data-word-index="${currentWordIndex}"] .char`);
          if (currentCharIndex < prevChars.length) {
            prevChars[currentCharIndex].classList.remove('correct', 'incorrect');
          }
        }

        highlightActiveChar();
        updateLiveStats();
        return;
      }

      if (e.key.length === 1) {
        const char = e.key;
        const expectedChar = currentWord[currentCharIndex];
        const charSpan = chars[currentCharIndex];

        typedChars[currentWordIndex].push(char);

        if (char === expectedChar) {
          charSpan.classList.add('correct');
          charSpan.classList.remove('incorrect');
        } else {
          charSpan.classList.add('incorrect');
          charSpan.classList.remove('correct');
        }

        currentCharIndex++;
        highlightActiveChar();
        updateLiveStats();
      }

      // End test immediately after last letter of last word is typed
      const isLastWord = currentWordIndex === words.length - 1;
      const isLastChar = currentCharIndex === currentWord.length;

      if (isLastWord && isLastChar) {
        endTest();
      }
    });

    function startTest() {
      generateWords();
      renderWords();
      currentWordIndex = 0;
      currentCharIndex = 0;
      startTime = null;
      testEnded = false;
      input.value = '';
      input.disabled = false;
      input.focus();
      highlightActiveChar();
      liveWpmDisplay.textContent = '0';
      liveAccDisplay.textContent = '0';
    }

    // Shortcut: Tab + Enter to restart test
    let tabPressed = false;

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        tabPressed = true;
      }

      if (tabPressed && e.key === 'Enter') {
        e.preventDefault();
        startTest();
        tabPressed = false;
      }
    });

    document.addEventListener('keyup', (e) => {
      if (e.key === 'Tab') {
        tabPressed = false;
      }
    });

    window.onload = startTest;
    document.body.addEventListener('click', () => input.focus());
  </script>

</body>
</html>
